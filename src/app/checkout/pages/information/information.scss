:host {
  display: block;
  /* Variables locales para este componente */
  --primary: #1f2937;    /* Texto oscuro */
  --accent: #2563eb;     /* Azul Shopify/Stripe */
  --border: #d1d5db;     /* Gris borde */
  --input-bg: #ffffff;
  --bg-hover: #f9fafb;
  --focus-ring: rgba(37, 99, 235, 0.15); /* Anillo azul suave */
  --error: #ef4444;
  --radius: 8px;         /* Bordes modernos */
}

/* Animación de entrada suave */
.step-animation {
  animation: fadeUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
}

h2 {
  font-size: 1.15rem;
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 20px;
  letter-spacing: -0.02em;
}

.mt-large { margin-top: 40px; }

/* --- HEADER CONTACTO --- */
.header-row {
  display: flex; justify-content: space-between; align-items: baseline;
  margin-bottom: 16px;
  flex-wrap: wrap; gap: 10px;

  .login-prompt {
    font-size: 0.85rem; color: #6b7280;
    a { 
      color: var(--accent); text-decoration: none; font-weight: 500; 
      &:hover { text-decoration: underline; }
    }
  }
}

/* =========================================
   FLOATING LABELS (La Parte Crítica)
   ========================================= */
.form-floating {
  position: relative;
  margin-bottom: 14px; /* Espacio entre inputs */

  input, select {
    width: 100%;
    height: 54px; /* Altura fija estándar */
    
    /* TRUCO ANTI-OVERLAP:
       Padding Superior: 24px (Espacio reservado para el label cuando sube)
       Padding Inferior: 8px (Espacio para el texto del usuario)
       Padding Lateral: 12px
    */
    padding: 24px 12px 8px 12px;
    
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--input-bg);
    
    font-size: 0.95rem;
    line-height: 1.25;
    color: var(--primary); /* Color del texto del usuario */
    
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    appearance: none; /* Quita estilos nativos de Safari/iOS */

    /* El placeholder nativo debe ser invisible */
    &::placeholder { color: transparent; }

    /* Estado Focus */
    &:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 4px var(--focus-ring);
      z-index: 10; /* Traer al frente */
    }

    /* Estado Error */
    &.ng-invalid.ng-touched {
      border-color: var(--error);
      &:focus { box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.15); }
    }
  }

  /* Etiqueta Flotante */
  label {
    position: absolute;
    left: 13px; /* Alineado con el padding-left del input (+1px visual) */
    
    /* ESTADO INICIAL (Centrado) */
    top: 50%;
    transform: translateY(-50%);
    
    font-size: 0.95rem;
    color: #6b7280; /* Gris placeholder */
    pointer-events: none; /* Clic traspasa al input */
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: top left;
    
    width: 90%; /* Evita que el label se salga si es muy largo */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* --- ACTIVACIÓN DE LA ANIMACIÓN --- */
  /* Cuando hay foco O cuando hay texto (placeholder no visible) */
  input:focus + label,
  input:not(:placeholder-shown) + label,
  select:focus + label,
  select:not([value=""]) + label,
  select.has-value + label {
    
    /* Posición Final (Arriba) */
    transform: translateY(-24px) scale(0.8); /* Sube y se hace pequeño */
    
    color: #4b5563; /* Color un poco más oscuro */
    font-weight: 500;
  }

  /* Mensaje de Error debajo del input */
  .error-text {
    font-size: 0.75rem; color: var(--error); margin-top: 4px; margin-left: 2px;
    animation: fadeIn 0.3s ease;
  }

  /* Icono derecho (Tooltip) */
  .field-icon {
    position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
    color: #9ca3af; width: 20px; cursor: help; pointer-events: auto;
  }
  
  &.with-icon input { padding-right: 42px; }
}

/* --- GRIDS DE FORMULARIO --- */
.form-row {
  display: grid; grid-template-columns: 1fr 1fr; gap: 14px;
  &.three-col { grid-template-columns: 1fr 1fr 1fr; }
}

/* Checkbox Moderno */
.checkbox-wrapper {
  display: flex; align-items: center; gap: 10px; margin-top: 8px;
  
  input[type="checkbox"] {
    width: 18px; height: 18px;
    accent-color: var(--accent); /* Color nativo del navegador */
    cursor: pointer;
  }
  
  label {
    font-size: 0.9rem; color: #374151; cursor: pointer; user-select: none;
  }
}

/* =========================================
   SELECTOR DE DIRECCIONES (Saved Addresses)
   ========================================= */
.address-selector {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 14px; margin-bottom: 25px;
}

.address-card {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  cursor: pointer;
  background: white;
  transition: all 0.2s ease;
  display: flex; align-items: flex-start; gap: 12px;
  position: relative;

  /* Hover */
  &:hover { border-color: #9ca3af; background: var(--bg-hover); }

  /* Radio Button Visual */
  .radio-circle {
    width: 18px; height: 18px;
    border: 1px solid #9ca3af; border-radius: 50%;
    margin-top: 2px; flex-shrink: 0;
    position: relative;
    background: white;
    transition: 0.2s;
    
    &::after {
      content: ''; position: absolute;
      top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
      width: 8px; height: 8px;
      background: white; border-radius: 50%;
      transition: transform 0.2s;
    }
  }

  .addr-info {
    display: flex; flex-direction: column;
    .alias { font-weight: 600; font-size: 0.9rem; color: var(--primary); }
    .detail { font-size: 0.85rem; color: #6b7280; margin-top: 2px; line-height: 1.3; }
  }

  /* ESTADO SELECCIONADO */
  &.selected {
    border-color: var(--accent);
    background: #eff6ff; /* Azul muy pálido */
    box-shadow: 0 0 0 1px var(--accent); /* Borde doble visual */
    
    .radio-circle {
      background: var(--accent); border-color: var(--accent);
      &::after { transform: translate(-50%, -50%) scale(1); }
    }
  }

  /* Botón "Nueva Dirección" */
  &.new-addr {
    align-items: center;
    .alias { color: var(--accent); }
    &:hover { background: #eff6ff; }
  }
}

/* Transición para el formulario cuando está deshabilitado visualmente */
.address-form {
  transition: opacity 0.3s, filter 0.3s;
  
  &.faded {
    opacity: 0.5;
    pointer-events: none; /* Bloquea clics */
    filter: grayscale(1);
  }
}

/* =========================================
   FOOTER ACCIONES
   ========================================= */
.step-footer {
  margin-top: 40px;
  display: flex; justify-content: space-between; align-items: center;

  
}

/* =========================================
   RESPONSIVE MÓVIL
   ========================================= */
@media (max-width: 600px) {
  .form-row, .form-row.three-col {
    grid-template-columns: 1fr; /* Todo a 1 columna */
    gap: 0; /* El margen inferior del .form-floating maneja el espacio */
  }
  
  .address-selector { grid-template-columns: 1fr; }
  
  .step-footer {
    flex-direction: column-reverse; /* Botón arriba, link abajo */
    gap: 20px;
    .btn-checkout-primary { width: 100%; }
    .link-back { width: 100%; justify-content: center; }
  }
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}