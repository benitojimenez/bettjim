<div class="product-card">
  <div class="card-image">
    <a [routerLink]="['/product', product().slug]" class="img-link">
      <img
        [src]="url_img + ImageSrc()"
        [alt]="product().title + ' BettJim.com'"
        [loading]="index() < 4 ? 'eager' : 'lazy'"
        [attr.fetchpriority]="index() < 4 ? 'high' : 'auto'"
      />
    </a>

    <div class="badges">
      @if (isDiscountActive()) {
      <span class="badge discount">-{{ product().discount }}%</span>
      } @if (product().new) {
      <span class="badge new">NUEVO</span>
      }
    </div>

    <div class="quick-actions">
      <button class="action-btn" title="Favoritos">
        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
          ></path>
        </svg>
      </button>

      <button class="action-btn" title="Ver Detalle" [routerLink]="['/product', product().slug]">
        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
          ></path>
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
          ></path>
        </svg>
      </button>
    </div>
  </div>

  <div class="card-info">
    @if (product().variants.length) {
    <div class="variants-section">
      <div class="variant-group">
        <div class="color-options">
          @for (variant of product().variants; track $index) {
          <button
            class="color-btn"
            [style.background-color]="variant.color_code"
            [title]="variant.color"
            (click)="ChangeVariants(variant, product())"
          ></button>
          }
        </div>
      </div>
    </div>
    }

    <span class="product-brand">BettJim Collection</span>

    <h3 class="product-title" style="cursor: pointer">
      <a [routerLink]="['/product', product().slug]">
        {{ product().title }}
      </a>
    </h3>

    <div class="rating-stars">
      <span class="star filled">★</span><span class="star filled">★</span
      ><span class="star filled">★</span><span class="star filled">★</span
      ><span class="star">★</span>
      <span class="rating-count">(24)</span>
    </div>

    <div class="price-row">
      <span class="current-price">{{
        product().price | appDiscount : product() | currency : ps.Currency.currency
      }}</span>

      @if (isDiscountActive()) {
      <span class="old-price">{{ product().price | currency : ps.Currency.currency }}</span>
      }
    </div>

    @if (product().type_inventory ===1) {
    <button
      (click)="cartService.addToCart(product())"
      [disabled]="ps.productsResource.isLoading()"
      class="btn-add-cart"
    >
      <span class="btn-text">AGREGAR</span>
      <span class="btn-icon">
        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
          ></path>
        </svg>
      </span>
    </button>
    }@else {
    <button class="btn-add-cart" [routerLink]="['/product', product().slug]">
      <span class="btn-text">ELEGIR</span>
      <span class="btn-icon">
        <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
          ></path>
        </svg>
      </span>
    </button>
    }
  </div>
</div>
